---
title: "Acute Changes in CEWL as a Function of Temperature: Data Analysis"
author: "Calvin Davis, Savannah Weaver"
date: "2022"
output: 
  rmdformats::html_clean:
    highlight: tango
    thumbnails: FALSE
    toc: TRUE
    toc_depth: 3
---



# Packages

```{r setup, echo=T, results='hide', message=FALSE}
if (!require("tidyverse")) install.packages("tidyverse") 
library("tidyverse") #tidyr, ggplot, dplyr, etc
if (!require("ggpubr")) install.packages("ggpubr") 
library("ggpubr") # arrange multi-panel figures
if (!require("lme4")) install.packages("lme4") 
library("lme4") # mixed-effect models
if (!require("lmerTest")) install.packages("lmerTest") 
library("lmerTest") # p-values
if (!require("car")) install.packages("car") 
library("car") # test for VIF
if (!require("broom.mixed")) install.packages("broom.mixed")
library("broom.mixed") # model export
if (!require("emmeans")) install.packages('emmeans')
library('emmeans') # effect sizes
if (!require("RColorBrewer")) install.packages("RColorBrewer")
library("RColorBrewer") # pretty colors
if (!require("rmdformats")) install.packages("rmdformats")
library("rmdformats") # clean html R markdown format
```



# Background

This code walks through the statistical models and figures for a study on the rate of change of cutaneous evaporative water loss (CEWL) in response to temperature change in Western Fence Lizards (*Sceloporus occidentalis*). Data was collected and analyzed by Calvin Davis and Savannah Weaver, and the project was advised by Dr. Emily Taylor at California Polytechnic State University. The sections with an asterisk are the stats and figures presented in the publication.


# Load Data

Get the RDS files created in the data wrangling Rmd:

```{r}
# treatment assignments etc
lizard_tmt_info <- read_rds("Data/collection_dat_formatted.RDS")

# data with temp AND CEWL
temp_time_series <- read_rds("Data/temp_time_series.RDS") %>% 
  dplyr::filter(lizard_ID != 410)

# data with CEWL, no body temp
CEWL_time_series <- read_rds("Data/CEWL_time_series.RDS") # not needed???
unique(CEWL_time_series$date)

# avg CEWL per body temp
CEWL_by_temp <- read_rds("./Data/CEWL_by_temp_tmt.RDS")


by_minute_indiv <- temp_time_series %>% 
  mutate(time_min_block = floor(time_min)) %>% 
  group_by(date, lizard_ID, treatment, time_min_block) %>% 
  summarise(CEWL_per_min = mean(CEWL_g_m2h),
            clo_temp_per_min = mean(calibrated_cloacal_temp),
            dors_temp_per_min = mean(calibrated_dorsal_temp)) 

by_minute_avg <- by_minute_indiv %>% 
  group_by(treatment, time_min_block) %>% 
  summarise(CEWL_min_avg = mean(CEWL_per_min),
            clo_temp_min_avg = mean(clo_temp_per_min),
            dors_temp_min_avg = mean(dors_temp_per_min))

by_temp_minute_avg <- by_minute_indiv %>% 
  mutate(clo_temp_chunk = floor(clo_temp_per_min)) %>% 
  group_by(treatment, clo_temp_chunk) %>% 
  summarise(CEWL_min_avg = mean(CEWL_per_min))
```




# Stats & Models


## * Temp Correlation

Check the correlation between dorsal and cloacal temps:


```{r temp corr}
temp_corr <- lm(data = by_minute_avg, 
                dors_temp_min_avg ~ clo_temp_min_avg)
summary(temp_corr)
```





## CEWL (raw) ~ temp LMM

First, test linear effects of temperature:

```{r CEWL LMM 2}
CEWL_LMM_02a <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             clo_temp_per_min *
                             treatment +
                             (1|date/lizard_ID))

CEWL_LMM_02b <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             dors_temp_per_min *
                             treatment +
                             (1|date/lizard_ID))
```

Compare to the inclusion of polynomial factors:

```{r CEWL LMM 3}
CEWL_LMM_03a <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             poly(clo_temp_per_min, 2)*treatment +
                             (1|date/lizard_ID))

anova(CEWL_LMM_03a, CEWL_LMM_02a)

CEWL_LMM_03b <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             poly(dors_temp_per_min, 2)*treatment +
                             (1|date/lizard_ID))

anova(CEWL_LMM_03b, CEWL_LMM_02b)
```

The poly models have significantly better explanatory power than the linear models.

Also try log transformation to make sure a polynomial effect is best. *But, cannot compare a log-log model because then the response variable would be different.*

```{r CEWL LMM 4}
CEWL_LMM_04a <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             log(clo_temp_per_min)*treatment +
                             (1|date/lizard_ID))

anova(CEWL_LMM_04a, CEWL_LMM_02a)
anova(CEWL_LMM_04a, CEWL_LMM_03a)

CEWL_LMM_04b <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             log(dors_temp_per_min)*treatment +
                             treatment +
                             (1|date/lizard_ID))

anova(CEWL_LMM_04b, CEWL_LMM_02b)
anova(CEWL_LMM_04b, CEWL_LMM_03b)
```


The logarithmic models are NOT better than the linear or polynomial ones. **The poly models are best** and the linear and log models are equally less-good. 


Check assumptions:

```{r}
plot(CEWL_LMM_03a)
plot(CEWL_LMM_03b)
vif(CEWL_LMM_03a)
vif(CEWL_LMM_03b)
```

There's no fanning or different pattern. VIF is negligible.

Re-run with p-values:

```{r CEWL LMM best 1}
CEWL_LMM_besta <- lmerTest::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             treatment * poly(clo_temp_per_min, 2) +
                             (1|date/lizard_ID))
summary(CEWL_LMM_besta)
CEWL_clo_anova <- data.frame(anova(CEWL_LMM_besta, type = "2", ddf = "Kenward-Roger")) %>% 
  mutate(variable = row.names(.))

CEWL_LMM_bestb <- lmerTest::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             treatment * poly(dors_temp_per_min, 2) +
                             (1|date/lizard_ID))
summary(CEWL_LMM_bestb)
CEWL_dors_anova <- data.frame(anova(CEWL_LMM_bestb, type = "2", ddf = "Kenward-Roger")) %>%
  mutate(variable = row.names(.))

# double check sample sizes
temp_time_series %>%
  group_by(lizard_ID, treatment) %>%
  summarise(n()) %>%
  group_by(treatment) %>%
  summarise(n())
```

These are the best models for CEWL ~ temperature. 





Export:

```{r export best CEWL LMM}
# model anovas
CEWL_temp_F_stats <- CEWL_clo_anova %>%
  rbind(CEWL_dors_anova) %>% 
  mutate(partial_sum_of_squares = round(Sum.Sq, 0), 
         F_only = round(F.value, 2),
         DenDF = round(DenDF, 0),
         F_statistic = paste(F_only, " (", NumDF, ",", DenDF, ")", sep = ""),
         p_value = (Pr..F.)) %>%
  dplyr::select(variable,
                partial_sum_of_squares,
                F_statistic, 
                p_value)
write.csv(CEWL_temp_F_stats, 
          "./Results_Statistics/CEWL_temp_F_stats.csv")

# model summaries
broom.mixed::tidy(CEWL_LMM_besta) %>%
  mutate(estimate = round(estimate, digits = 2),
         std.error = round(std.error, digits = 2),
         statistic = round(statistic, digits = 2),
         df = round(df, digits = 0)) %>%
  dplyr::select(effect, group, term, estimate, 
                std.error, statistic, df, p.value) %>%
  write.csv("./Results_Statistics/CEWL_best_model_clotemp.csv")

broom.mixed::tidy(CEWL_LMM_bestb) %>%
  mutate(estimate = round(estimate, digits = 2),
         std.error = round(std.error, digits = 2),
         statistic = round(statistic, digits = 2),
         df = round(df, digits = 0)) %>%
  dplyr::select(effect, group, term, estimate, 
                std.error, statistic, df, p.value) %>%
  write.csv("./Results_Statistics/CEWL_best_model_dorstemp.csv")
```








## CEWL (raw) ~ time LMM

NOTE: Start times vary from 97-170 seconds after starting time series.

Make a polynomial model first:

```{r CEWL time LMM 1}
rates_LMM_01 <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             poly(time_min_block, 2) * treatment +
                             (1|date/lizard_ID))
summary(rates_LMM_01)
```

Also make a linear model version:

```{r CEWL time LMM 2}
rates_LMM_02 <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             time_min_block * treatment +
                             (1|date/lizard_ID))

anova(rates_LMM_02, rates_LMM_01)
```

Polynomial is much better than linear. 

Also compare to log version:

```{r CEWL time LMM 3}
rates_LMM_03 <- lme4::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             log(time_min_block) * treatment +
                             (1|date/lizard_ID))

rates_LMM_03_loglog <- lme4::lmer(data = by_minute_indiv,
                          log(CEWL_per_min) ~ 
                             log(time_min_block) * treatment +
                             (1|date/lizard_ID))
```

The polynomial model is best (slightly better than log and much better than lm options).

Check linear regression assumptions:

```{r}
plot(rates_LMM_01)
vif(rates_LMM_01)
```


re-run with p-values:

```{r CEWL LMM best 2}
rates_LMM_best <- lmerTest::lmer(data = by_minute_indiv,
                          CEWL_per_min ~ 
                             poly(time_min_block, 2) * treatment +
                             (1|date/lizard_ID))
summary(rates_LMM_best)
anova(rates_LMM_best, type = "2", ddf = "Kenward-Roger")

# double check sample sizes
CEWL_time_series %>%
  group_by(lizard_ID, treatment) %>%
  summarise(n()) %>%
  group_by(treatment) %>%
  summarise(n())
```


Export:

```{r}
broom.mixed::tidy(rates_LMM_best) %>%
  mutate(estimate = round(estimate, digits = 2),
         std.error = round(std.error, digits = 2),
         statistic = round(statistic, digits = 2),
         df = round(df, digits = 0)) %>%
  dplyr::select(effect, group, term, estimate, 
                std.error, statistic, df, p.value) %>%
  write.csv("./Results_Statistics/CEWL_best_model_time.csv")
```




## Rate of Change


### * Tb ~ Time

```{r}
lizard_temp_time_lm_log <- lm(data = temp_time_series, 
                          log(calibrated_cloacal_temp) ~ 
                            log(time_min)*lizard_ID)
plot(lizard_temp_time_lm_log)
```




Now get the trend/slope for each individual and make into a variable in df.

```{r}
lizard_coeffs_temp <- data.frame(emtrends(lizard_temp_time_lm_log, 
                                          "lizard_ID", var = "time_min")) %>%
   left_join(lizard_tmt_info, 
             by = c("lizard_ID" = "individual_ID")) %>%
   dplyr::select(lizard_ID, rate_change = time_min.trend, 
                 SE, df, lower.CL, upper.CL,
                 date,
                 treatment
                 ) %>%
   dplyr::mutate(date_factor = as.factor(date))
summary(lizard_coeffs_temp)
length(unique(lizard_coeffs_temp$lizard_ID))
```

then get average rate of change by treatment group:

```{r}
avg_temp_change <- lm(data = lizard_coeffs_temp, rate_change ~ treatment)
summary(avg_temp_change)
avg_temp_change_coeff <- data.frame(emmeans(avg_temp_change, "treatment"))
avg_temp_change_coeff
avg_temp_change_pairs <- data.frame(pairs(emmeans(avg_temp_change, "treatment")))
avg_temp_change_pairs
```


and finally, t-tests of rate of change per tmt group:

```{r}
lizard_coeffs_temp_control <- lizard_coeffs_temp %>% 
  dplyr::filter(treatment == "Control")
t.test(lizard_coeffs_temp_control$rate_change)

lizard_coeffs_temp_cool <- lizard_coeffs_temp %>% 
  dplyr::filter(treatment == "Cooling")
t.test(lizard_coeffs_temp_cool$rate_change)

lizard_coeffs_temp_heat <- lizard_coeffs_temp %>% 
  dplyr::filter(treatment == "Heating")
t.test(lizard_coeffs_temp_heat$rate_change)
```










### * CEWL ~ Time

We want to know why each lizard had a different rate of change of CEWL during the 15-minute temperature treatment and measurement period.

First, calculate rate of change for each lizard:

```{r CEWL rate of change LM}
lizard_CEWL_time_lm_log <- lm(data = temp_time_series,
                          log(CEWL_g_m2h) ~ 
                             log(time_min)*lizard_ID)
plot(lizard_CEWL_time_lm_log)
```

Now get the trend/slope for each individual and make into a variable in df.

```{r}
lizard_coeffs_CEWL <- data.frame(emtrends(lizard_CEWL_time_lm_log, 
                                     "lizard_ID", var = "time_min")) %>%
   left_join(lizard_tmt_info, 
             by = c("lizard_ID" = "individual_ID")) %>%
   dplyr::select(lizard_ID, rate_change = time_min.trend, 
                 SE, df, lower.CL, upper.CL,
                 date,
                 treatment,
                 mass_g, SVL_mm,
                 chamber_time_elapsed_hr
                 ) %>%
   dplyr::mutate(date_factor = as.factor(date))
summary(lizard_coeffs_CEWL)
length(unique(lizard_coeffs_CEWL$lizard_ID))
```



NOW we can look at how the RATE of CEWL change (CEWL change per MINUTE) is different among lizards.

```{r CEWL rate of change LMM 1}
change_LMM_1 <- lme4::lmer(data = lizard_coeffs_CEWL,
                          rate_change ~ # remember estimate is CEWL PER MINUTE
                             treatment + 
                       mass_g + SVL_mm + 
                       chamber_time_elapsed_hr + 
                  # include date as random effect bc sig diff weather
                       (1|date_factor))

drop1(change_LMM_1)
anova(change_LMM_1)
```

Drop mass first based on low SS and resulting AIC:

```{r CEWL rate of change LMM 2}
change_LMM_2 <- lme4::lmer(data = lizard_coeffs_CEWL,
                          rate_change ~ # remember estimate is CEWL PER MINUTE
                             treatment + 
                       SVL_mm + 
                       chamber_time_elapsed_hr + 
                  # include date as random effect bc sig diff weather
                       (1|date_factor))
drop1(change_LMM_2)
anova(change_LMM_2)
```



drop SVL:

```{r CEWL rate of change LMM 3}
change_LMM_3 <- lme4::lmer(data = lizard_coeffs_CEWL,
                          rate_change ~ # remember estimate is CEWL PER MINUTE
                             treatment + 
                             chamber_time_elapsed_hr + 
                  # include date as random effect bc sig diff weather
                       (1|date_factor))
drop1(change_LMM_3)
anova(change_LMM_3)
```


drop chamber_time_elapsed_hr:

```{r CEWL rate of change LMM 4}
change_LMM_4 <- lme4::lmer(data = lizard_coeffs_CEWL,
                          rate_change ~ 
                             treatment + 
                       (1|date_factor))
drop1(change_LMM_4)
anova(change_LMM_4)
```

The simplest model is our best/final model.

Check assumptions:

```{r}
plot(change_LMM_4)
```

Assumptions look good.

Save with p-values and remove the random effect because it did not account for any variation:

```{r best rate of change model}
change_CEWL_best <- lm(data = lizard_coeffs_CEWL,
                          rate_change ~ # remember estimate is CEWL PER MINUTE
                             treatment)
summary(change_CEWL_best)
```

Treatment group explained a significant amount of the variation.

and get average change ~ tmt:

```{r tmt pairwise change}
avg_CEWL_change_coeff <- data.frame(emmeans(change_CEWL_best, "treatment"))
avg_CEWL_change_coeff
avg_CEWL_change_pairs <- data.frame(pairs(emmeans(change_CEWL_best, "treatment"))) # p values
avg_CEWL_change_pairs
```



and finally, t-tests of rate of change per tmt group:

```{r}
lizard_coeffs_CEWL_control <- lizard_coeffs_CEWL %>% 
  dplyr::filter(treatment == "Control")
t.test(lizard_coeffs_CEWL_control$rate_change)

lizard_coeffs_CEWL_cool <- lizard_coeffs_CEWL %>% 
  dplyr::filter(treatment == "Cooling")
t.test(lizard_coeffs_CEWL_cool$rate_change)

lizard_coeffs_CEWL_heat <- lizard_coeffs_CEWL %>% 
  dplyr::filter(treatment == "Heating")
t.test(lizard_coeffs_CEWL_heat$rate_change)
```











### * CEWL ~ Temp


```{r}
lizard_CEWL_temp_loglog_lm <- lm(data = temp_time_series, 
                                 log(CEWL_g_m2h) ~ log(calibrated_cloacal_temp) * lizard_ID)
plot(lizard_CEWL_temp_loglog_lm)
```




Now get the trend/slope for each individual and make into a variable in df.

```{r}
lizard_coeffs_CEWL_temp <- data.frame(emtrends(lizard_CEWL_temp_loglog_lm, 
                                          "lizard_ID", var = "calibrated_cloacal_temp")) %>%
   left_join(lizard_tmt_info, 
             by = c("lizard_ID" = "individual_ID")) %>%
   dplyr::select(lizard_ID, rate_change = calibrated_cloacal_temp.trend, 
                 SE, df, lower.CL, upper.CL,
                 date,
                 treatment
                 ) %>%
   dplyr::mutate(date_factor = as.factor(date))
length(unique(lizard_coeffs_CEWL_temp$lizard_ID))
```

then get average rate of change by treatment group:

```{r}
avg_CEWL_temp_change <- lm(data = lizard_coeffs_CEWL_temp, rate_change ~ treatment)
summary(avg_CEWL_temp_change)
avg_CEWL_temp_change_coeff <- data.frame(emmeans(avg_CEWL_temp_change, "treatment"))
avg_CEWL_temp_change_coeff
avg_CEWL_temp_change_pairs <- data.frame(pairs(emmeans(avg_CEWL_temp_change, "treatment")))
avg_CEWL_temp_change_pairs
```


and finally, t-tests of rate of change per tmt group:

```{r}
lizard_coeffs_CEWL_temp_control <- lizard_coeffs_CEWL_temp %>% 
  dplyr::filter(treatment == "Control")
t.test(lizard_coeffs_CEWL_temp_control$rate_change)

lizard_coeffs_CEWL_temp_cool <- lizard_coeffs_CEWL_temp %>% 
  dplyr::filter(treatment == "Cooling")
t.test(lizard_coeffs_CEWL_temp_cool$rate_change)

lizard_coeffs_CEWL_temp_heat <- lizard_coeffs_CEWL_temp %>% 
  dplyr::filter(treatment == "Heating")
t.test(lizard_coeffs_CEWL_temp_heat$rate_change)
```













# Figures

## COLOR

```{r}
cool <- c(brewer.pal(11, "RdBu")[c(11)])
heat <- c(brewer.pal(11, "RdBu")[c(2)])
control <- c(brewer.pal(9, "Greys")[c(5)])
cntrls <- c(brewer.pal(9, "Greys")[c(7, 5, 3, 5, 4, 5, 3, 6, 7, 3, 6)])
```


## cloacal temp ~ time

```{r c temp time}
ggplot(temp_time_series) +
   aes(x = time_sec, 
       y = calibrated_cloacal_temp,
       group = lizard_ID,
       color = treatment) +
   geom_line(size = 0.2) +
  geom_smooth(se=F, method = "lm") +
   theme_classic() +
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x = "Time (seconds)" , 
        y = "Internal Body Temperature (°C)", 
        color = "Treatment", se = FALSE) -> ctemp_time
ctemp_time

ggplot(temp_time_series) +
   aes(x = log(time_sec), 
       y = log(calibrated_cloacal_temp),
       group = lizard_ID,
       color = treatment) +
   geom_line() +
   theme_classic() +
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x = "Time (seconds)" , 
        y = "Internal Body Temperature (°C)", 
        color = "Treatment", se = FALSE) -> ctemp_time_log
ctemp_time_log
```






## * cloacal temp (relative) ~ time

```{r c temp relative ~ time}
ggplot(temp_time_series) +
   aes(x = time_min, 
       y = relative_clo_temp,
       group = lizard_ID,
       color = treatment) +
  
   geom_hline(yintercept = 0, size = 0.5,
              linetype = "dashed", color = "black") +
  
   geom_line() +
   
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        plot.margin = margin(t = 1, r = 1, b = 1, l = 4.1, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  scale_x_continuous(limits = c(1,15),
                     breaks = c(seq(1, 15, 2)),
                     labels = c(seq(1, 15, 2))) +
  scale_y_continuous(limits = c(-21,21),
                     breaks = c(-20, -10, 0, 10, 20),
                     labels = c(-20, -10, 0, 10, 20)) +
  
  annotate("text", x = 12, y = -2, label = "Control", parse = T,
           size = 2.9, family = "sans", color = control) +
  annotate("text", x = 4, y = -11, label = "Cooling", parse = T,
           size = 2.9, family = "sans", color = cool) +
  annotate("text", x = 4, y = 10, label = "Heating", parse = T,
           size = 2.9, family = "sans", color = heat) +
  
   labs(x = "Time (minutes)" , 
        y = expression('Relative T'[b]~' (°C)'),
        color = "Treatment", se = FALSE) -> ctemp_time_relative
ctemp_time_relative
```



## * Temp Rate of Change

```{r rate of change temp fig}
ggplot() +
  geom_hline(yintercept = 0, size = 0.5,
              linetype = "dashed", color = "black") +
  
  geom_point(data = lizard_coeffs_temp,
              aes(x = treatment,
                   y = rate_change,
                   shape = treatment,
                   color = treatment,
                   fill = treatment),
                   size = 1,
               alpha = 0.3,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = avg_temp_change_coeff,
                aes(x = treatment,
                    y = emmean, 
                    color = treatment,
                    group = treatment,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = 0.3,
                alpha = 0.9) +
  geom_point(data = avg_temp_change_coeff,
             aes(x = treatment,
                   y = emmean,
                 shape = treatment,
                 fill = treatment),
              color = "black",
              size = 3) +
  
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        plot.margin = margin(t = 1, r = 1, b = 1, l = 1, unit = "pt"),
        axis.title.y = element_text(vjust = -3)
        ) +
  
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  scale_fill_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
  scale_y_continuous(limits = c(-0.06, 0.06),
                     breaks = c(-0.05, 0, 0.05),
                     labels = c(-0.05, 0, 0.05)) +
  
  # ylim(-1.8, 1.8) + this is what I used originally... not sure what happened

   annotate("text", x = 1, y = 0.06, label = "a", size = 3) +
   annotate("text", x = 2, y = 0.06, label = "b", size = 3) +
   annotate("text", x = 3, y = 0.06, label = "c", size = 3) +
  
  annotate("text", x = 1, y = 0.052, label = "***", size = 4) +
  annotate("text", x = 2, y = 0.052, label = "***", size = 4) +
  annotate("text", x = 3, y = 0.052, label = "***", size = 4) +
  
   labs(x = "" , 
        y = expression(Delta ~ 'log-T'[b]~'  log-'*min^-1*''),
        color = "Treatment") -> rate_change_temp_fig
rate_change_temp_fig

# save
ggsave(filename = "temp_change_min.pdf",
       plot = rate_change_temp_fig,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 60)
```








## dorsal temp ~ time

```{r d temp time}
ggplot(temp_time_series) +
   aes(x = time_sec, 
       y = calibrated_dorsal_temp,
       group = lizard_ID,
       color = treatment) +
   geom_line() +
   theme_classic() +
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x= "Time (seconds)" , 
        y= "Surface Body Temperature (°C)", 
        color ="Treatment") -> dtemp_time
dtemp_time
```


## CEWL (raw) ~ time

```{r CEWL time}
ggplot(temp_time_series) +
   aes(x = time_sec, 
       y = CEWL_g_m2h,
       group = lizard_ID,
       color = treatment) +
   geom_line() +
   # geom_point(size = 0.01, 
   #            alpha = 0.25) +
   # geom_smooth(method = "loess", 
   #             size = 2.5, 
   #             se = F) +
   theme_classic() +
   theme(text = element_text(size = 15)) + 
   theme(axis.text.x = element_text(size = 10)) +
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x = "Time (seconds)" , 
        y = bquote('CEWL (g/'*m^2*'h)'), 
        color = "Treatment", 
        se = FALSE) +
   scale_x_continuous(limits = c(0, 925), 
                      breaks=seq(0, 950, 100)) -> CEWL_time
CEWL_time
```




## CEWL (MIN) ~ time

```{r CEWL time per minute}
ggplot(by_minute_avg) +
   aes(x= time_min_block, 
       y = CEWL_min_avg,
       group = treatment,
       color = treatment
       ) +
   geom_point(size = 1, 
              alpha = 0.5) +
  geom_line() +
  geom_smooth(method = "lm",
              se = F) +
   theme_classic() +
   theme(text = element_text(size = 15)) + 
   theme(axis.text.x = element_text(size = 10)) +
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x = "Time (seconds)" , 
        y = bquote('CEWL (g/'*m^2*'h)'), 
        color = "Treatment", 
        se = FALSE)  -> CEWL_time_min
CEWL_time_min
```



## legend

This code uses one of our plots to make a large, detailed legend, which we can save and use in ggarrange later.

```{r make a fancy legend}
ggplot(temp_time_series) +
   
   geom_smooth(aes(x = (calibrated_cloacal_temp), 
       y = CEWL_g_m2h,
       color = treatment),
       method = "lm", 
        formula = y ~ poly(x, 2),
               size = 1, 
               se = F) +
  geom_point(aes(x = (calibrated_cloacal_temp), 
       y = CEWL_g_m2h,
       fill = treatment,
       shape = treatment),
       size = 4, 
       alpha = 1) +
  
  scale_x_continuous(limits = c(14, 39),
                     breaks = c(seq(15, 35, 5)),
                     labels = c(seq(15, 35, 5))) +
  theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = c(0.5,0.5)) +
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") +
   scale_fill_manual(values = c("Control" = control,
                                   "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  scale_color_manual(values = c("Control" = control,
                                   "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment")  -> fancy_legend
fancy_legend # view

# save
LEGEND <- as_ggplot(get_legend(fancy_legend)) 

# export
ggsave(filename = "legend_only.pdf",
       plot = LEGEND,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 40, height = 30)
```



## * CEWL (raw) ~ cloacal temperature

```{r CEWL cloacal temp}
ggplot() +
  
  # data per individual lizard
  geom_line(
    data = temp_time_series,
    aes(
      x = calibrated_cloacal_temp,
      y = CEWL_g_m2h,
      group = lizard_ID,
      color = treatment
    ),
    alpha = 0.3
  ) +
  
  # avg values per whole deg C
  geom_line(
    data = CEWL_by_temp,
    aes(
      x = rounded_cal_c_temp,
      y = mean_mean_CEWL,
      group = treatment,
      color = treatment
    ),
    size = 1
  ) +

  # annotations for cooling group
   annotate(geom = "point", x = 19, y = 5.4, 
           size = 3, pch = 25, fill = cool) + 
   annotate("text", x = 17.2, y = 3, label = "T[15]", parse = T,
           size = 3, family = "sans", color = cool) +
   annotate(geom = "point", x = 34, y = 12, 
           size = 3, pch = 25, fill = cool) + 
   annotate("text", x = 35.8, y = 12, label = "T[1]", parse = T,
           size = 3, family = "sans", color = cool) +
  
  # annotations for heating group
   annotate(geom = "point", x = 17, y = 11, 
           size = 3, pch = 24, fill = heat) +  
   annotate("text", x = 15.5, y = 11, label = "T[1]", parse = T,
           size = 3, family = "sans", color = heat) +
   annotate(geom = "point", x = 34, y = 20, 
           size = 3, pch = 24, fill = heat) +
   annotate("text", x = 35.5, y = 20.5, label = "T[15]", parse = T,
           size = 3, family = "sans", color = heat) +
   
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        plot.margin = margin(t = 1, r = 1, b = 1, l = 1, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                   "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
  scale_x_continuous(limits = c(10, 40),
                     breaks = c(seq(10, 40, 10)),
                     labels = c(seq(10, 40, 10))) +
  scale_y_continuous(limits = c(0, 31),
                     breaks = c(seq(0, 30, 10)),
                     labels = c(seq(0, 30, 10))) +
  
   labs(x = expression('T'[b]~' (°C)'),
        y = bquote('CEWL (g '*m^-2*' '*h^-1*')'), 
        se = FALSE) -> CEWL_ctemp
CEWL_ctemp

# save
ggsave(filename = "CEWL_int_body_temp.pdf",
       plot = CEWL_ctemp,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 150, height = 100)
```




## CEWL (log-log) ~ cloacal temperature

```{r CEWL log cloacal temp}
ggplot(temp_time_series) +
  aes(x = log(calibrated_cloacal_temp), 
      y = log(CEWL_g_m2h),
      group = lizard_ID,
      shape = treatment,
      color = treatment) +
  geom_line() +
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "right",
        plot.margin = margin(t = 6, r = 6, b = 6, l = 6, unit = "pt")) +
  
   labs(x = "log- Internal Body Temperature (°C)" , 
        y = bquote('log- CEWL (g '*m^-2*' '*h^-1*')'), 
        se = FALSE) -> CEWL_ctemp_log
CEWL_ctemp_log

# save
ggsave(filename = "CEWL_int_body_temp.pdf",
       plot = CEWL_ctemp,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 150, height = 100)
```



## CEWL (MIN) ~ cloacal temperature

```{r CEWL cloacal temp per minute}
ggplot(by_minute_indiv) +
  aes(
    x = log(clo_temp_per_min),
    y = log(CEWL_per_min),
    group = lizard_ID,
    shape = treatment,
    color = treatment
  ) +
  geom_point(size = 1, 
               alpha = 0.8) +
  geom_line() +
  # scale_x_continuous(limits = c(12.5, 40),
  #                    breaks = c(seq(15, 35, 5)),
  #                    labels = c(seq(15, 35, 5))) +

   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 6, l = 6, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                   "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
   labs(x = "Internal Body Temperature (°C)" , 
        y = bquote('CEWL (g '*m^-2*' '*h^-1*')'), 
        se = FALSE)
```



## CEWL (MIN avg) ~ cloacal temperature

```{r CEWL cloacal temp avg per minute}
ggplot(by_minute_avg) +
  aes(
    x = clo_temp_min_avg,
    y = CEWL_min_avg,
    #group = lizard_ID,
    shape = treatment,
    color = treatment
  ) +
   geom_point(size = 1, 
               alpha = 0.8) +
  geom_line() +
   geom_smooth(method = "lm",
        #formula = y ~ poly(x, 2),
               size = 1.5,
               se = F) +
  scale_x_continuous(limits = c(12.5, 40),
                     breaks = c(seq(15, 35, 5)),
                     labels = c(seq(15, 35, 5))) +

   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 6, l = 6, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                   "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
   labs(x = "Internal Body Temperature (°C)" , 
        y = bquote('CEWL (g '*m^-2*' '*h^-1*')'), 
        se = FALSE)

ggplot(by_temp_minute_avg) +
  aes(
    x = clo_temp_chunk,
    y = CEWL_min_avg,
    #group = lizard_ID,
    shape = treatment,
    color = treatment
  ) +
   geom_point(size = 1, 
               alpha = 0.8) +
  geom_line() +
   geom_smooth(method = "lm",
        #formula = y ~ poly(x, 2),
               size = 1.5,
               se = F)
```



















## CEWL Control

```{r CEWL ~ CONTRL temp by individual}
# get control data only
temp_time_series %>%
  dplyr::filter(treatment == "Control") %>%
  # pipe into ggplot
  ggplot() +
   aes(x = calibrated_cloacal_temp, 
       y = CEWL_g_m2h,
       color = lizard_ID) +
  
   geom_point(size = 0.1, 
               alpha = 0.1) +
   geom_smooth(method = "lm", 
               size = 1, 
               se = F) +

   ylim(0,32) +
   xlim(25,31) +
  
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 6, l = 6, unit = "pt")) +
  
   scale_color_manual(values = cntrls) +
  
   labs(x = "Internal Body Temperature (°C)" , 
        y = bquote('CEWL (g '*m^-2*' '*h^-1*')'), 
        color = "Treatment", 
        se = FALSE) -> CEWL_control
CEWL_control

# save
ggsave(filename = "CEWL_temp_control_lm.pdf",
       plot = CEWL_control,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 60)
```




## * CEWL (relative) ~ time


```{r relative CEWL time}
# check n lizard sample size
temp_time_series %>%
  dplyr::filter(complete.cases(time_min, relative_CEWL)) %>%
  group_by(lizard_ID) %>%
  summarise(max(relative_CEWL)) %>%
  nrow()

# plot
ggplot(temp_time_series) +
  aes(
    x= time_min, 
    y = relative_CEWL,
    group = lizard_ID,
    color = treatment
  ) +
  
   geom_hline(yintercept = 0, size = 0.5,
              linetype = "dashed", color = "black") +
  
   geom_line() +
   
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        axis.title.y = element_text(vjust = 0.5),
        plot.margin = margin(t = 1, r = 1, b = 1, l = 1, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat),
                      name = "Treatment") +
  
  scale_x_continuous(limits = c(1,15),
                     breaks = c(seq(1, 15, 2)),
                     labels = c(seq(1, 15, 2))) +
  scale_y_continuous(limits = c(-18,18),
                     breaks = c(-10, 0, 10),
                     labels = c(-10, 0, 10)) +
  
  # annotate("text", x = 12, y = -2, label = "Control", parse = T,      # too cluttered
  #          size = 5, family = "sans", color = control) +
  annotate("text", x = 4, y = -15, label = "Cooling", parse = T, #9.3
           size = 2.9, family = "sans", color = cool) +
  annotate("text", x = 4, y = 7, label = "Heating", parse = T,
           size = 2.9, family = "sans", color = heat) +
  
   labs(x = " ", #"Time (minutes)" , 
        y = bquote('Relative CEWL (g '*m^-2*' '*h^-1*')')) -> CEWLr_time
  
CEWLr_time

# save
ggsave(filename = "CEWL_relative_time.pdf",
       plot = CEWLr_time,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 150, height = 100)
```






## * CEWL Rate of Change

```{r rate of change CEWL fig}
ggplot() +
  geom_hline(yintercept = 0, size = 0.5,
              linetype = "dashed", color = "black") +
  
  geom_point(data = lizard_coeffs_CEWL,
              aes(x = treatment,
                   y = rate_change,
                   shape = treatment,
                   color = treatment,
                   fill = treatment),
                   size = 1,
               alpha = 0.3,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = avg_CEWL_change_coeff,
                aes(x = treatment,
                    y = emmean, 
                    color = treatment,
                    group = treatment,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .3,
                alpha = 0.9) +
  geom_point(data = avg_CEWL_change_coeff,
             aes(x = treatment,
                   y = emmean,
                 shape = treatment,
                 fill = treatment),
              color = "black",
              size = 3) +
  
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        axis.title.y = element_text(vjust = -1.8),
        plot.margin = margin(t = 1, r = 1, b = 1, l = 5.1, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  scale_fill_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
  scale_y_continuous(limits = c(-0.1, 0.1),
                     breaks = c(-0.1, 0, 0.1),
                     labels = c(-0.1, 0, 0.1)) +
  
   annotate("text", x = 1, y = 0.1, label = "a", size = 3) +
   annotate("text", x = 2, y = 0.1, label = "b", size = 3) +
   annotate("text", x = 3, y = 0.1, label = "c", size = 3) +
  
  annotate("text", x = 1, y = 0.086, label = "*", size = 4) +
  annotate("text", x = 2, y = 0.086, label = "***", size = 4) +
  annotate("text", x = 3, y = 0.086, label = "*", size = 4) +
  
   labs(x = "" , 
        y = expression(Delta ~ 'log-CEWL  log-'*min^-1*''),
        color = "Treatment") -> rate_change_CEWL_fig
rate_change_CEWL_fig


# save
ggsave(filename = "CEWL_change_min.pdf",
       plot = rate_change_CEWL_fig,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 60)
```





## * CEWL-Temp Rate of Change

```{r rate of change CEWL~temp fig}
ggplot() +
  geom_hline(yintercept = 0, size = 0.5,
              linetype = "dashed", color = "black") +
  
  geom_point(data = lizard_coeffs_CEWL_temp,
              aes(x = treatment,
                   y = rate_change,
                   shape = treatment,
                   color = treatment,
                   fill = treatment),
                   size = 1,
               alpha = 0.3,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = avg_CEWL_temp_change_coeff,
                aes(x = treatment,
                    y = emmean, 
                    color = treatment,
                    group = treatment,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .3,
                alpha = 0.9) +
  geom_point(data = avg_CEWL_temp_change_coeff,
             aes(x = treatment,
                   y = emmean,
                 shape = treatment,
                 fill = treatment),
              color = "black",
              size = 3) +
  
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        axis.title.y = element_text(vjust = -0.5),
        plot.margin = margin(t = 1, r = 1, b = 4, l = 1, unit = "pt")) +
  
   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  scale_fill_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
  
  scale_shape_manual(values = c(21,25,24),
                     name = "Treatment") + 
  
  scale_y_continuous(limits = c(-0.6, 0.6),
                     breaks = c(-0.5, 0, 0.5),
                     labels = c(-0.5, 0, 0.5)) +
  
  # pairwise comparisons between tmt groups
   annotate("text", x = 1, y = 0.6, label = "a", size = 3) +
   annotate("text", x = 2, y = 0.6, label = "b", size = 3) +
   annotate("text", x = 3, y = 0.6, label = "b", size = 3) +
  
  # t-tests for each tmt group
  annotate("text", x = 1, y = 0.52, label = "*", size = 4) +
  annotate("text", x = 2, y = 0.52, label = "**", size = 4) +
  annotate("text", x = 3, y = 0.52, label = "*", size = 4) +
  
   labs(x = "" ,
        y = expression(Delta ~ 'log-CEWL  log-T'[b]),
        color = "Treatment") -> rate_change_CEWL_temp_fig
rate_change_CEWL_temp_fig


# save
ggsave(filename = "CEWL_temp_change.pdf",
       plot = rate_change_CEWL_temp_fig,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 60)
```













## * Experimental Design Skematic (fig 1)

We created reference values to use to make a figure that would show each step of our experiment. 

```{r load exp design values}
exp_design <- read.csv("./Data/exp design.csv", 
                            header = TRUE,
                            fileEncoding="UTF-8-BOM")
```

```{r make exp design figure}
ggplot(exp_design) +
  
  # fake data to show exp plan
   aes(x = time_min, 
       y = temp_C,
       color = treatment) +
     geom_line(size = 1) +
  
  # vertical lines delineating exp stages
   geom_vline(xintercept = 60,
              alpha = 0.5,
              size = 0.5,
              linetype = "dashed", color = "black") +
   geom_vline(xintercept = 65,
              alpha = 0.5,
              size = 0.5,
              linetype = "dashed", color = "black") +
   geom_vline(xintercept = 80,
              alpha = 0.5,
              size = 0.5,
              linetype = "dashed", color = "black") +
  
  # pretty-fy
   theme_classic() +
   theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.position = "none",
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +

   scale_color_manual(values = c("Control" = control,
                                     "Cooling" = cool,  
                                     "Heating" = heat)) +
   labs(x = "Time" , 
        y = expression('Target T'[b]~' (°C)'),
        color = "Treatment") +
   
  # add labels for different exp stages
  annotate("text", x = 30, y = 37, label = "(a)", parse = T,
           size = 3.1, family = "sans", color = "black") +
  annotate("text", x = 62.5, y = 37, label = "(b)", parse = T,
           size = 3.1, family = "sans", color = "black") +
  annotate("text", x = 72.5, y = 37, label = "(c)", parse = T,
           size = 3.1, family = "sans", color = "black") +
  
  # add shapes to ends of lines to show tmt groups
   annotate(geom = "point", x = 80, y = 25, 
           size = 3, pch = 21, fill = control) +
   annotate(geom = "point", x = 80, y = 20, 
           size = 3, pch = 25, fill = cool) + 
   annotate(geom = "point", x = 80, y = 30, 
           size = 3, pch = 24, fill = heat) +
  
  # add tmt group name labels
  annotate("text", x = 35, y = 24, label = "Control", parse = T,
           size = 2.9, family = "sans", color = control) +
  annotate("text", x = 18, y = 30, label = "Cooling", parse = T,
           size = 2.9, family = "sans", color = cool) +
  annotate("text", x = 18, y = 20, label = "Heating", parse = T,
           size = 2.9, family = "sans", color = heat) +
   
   scale_y_continuous(limits = c(15, 37), 
                      breaks=seq(15, 35, 5)) -> methods_schmatic_fig
methods_schmatic_fig

# save
ggsave(filename = "methods_schematic.pdf",
       plot = methods_schmatic_fig,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 60)
```
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

# Save Grouped Figures



## * CEWL & Tb x relative & rate of change (Fig 2)

```{r}
CEWL_temp_multi <- ggarrange(
  CEWLr_time, rate_change_CEWL_fig, ctemp_time_relative, rate_change_temp_fig,
  nrow = 2, ncol = 2,
  widths = c(2,1.2),
  labels = c("(a)", "(b)", "(c)", "(d)"),
  font.label = list(color = "black", face = "bold", size = 10),
  label.x = 0.02,
  label.y = 1.01
)

ggsave(filename = "CEWL_temp_relative_and_change.pdf",
       plot = CEWL_temp_multi,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 160, height = 140)
```



## * CEWL ~ Tb

```{r}
CEWL_temp_relation <- ggarrange(
  CEWL_ctemp, rate_change_CEWL_temp_fig,
  nrow = 1, ncol = 2,
  widths = c(2,1.2),
  labels = c("(a)", "(b)"),
  font.label = list(color = "black", face = "bold", size = 10),
  #label.x = 0.01,
  label.y = 1.015
)

ggsave(filename = "CEWL_versus_temp.pdf",
       plot = CEWL_temp_relation,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 160, height = 70)
```








## Relative CEWL & Rate of Change

```{r}
multi_fig_relative <- ggarrange(CEWLr_time, 
          ggarrange(rate_change_CEWL_fig, LEGEND, 
                    nrow = 1, ncol = 2,
                    widths = c(2,1),
                    align = "hv"
                    ),
          nrow = 2, ncol = 1,
          heights = c(2,1),
          labels = c("A", "B"))
multi_fig_relative

ggsave(filename = "CEWL_time_multi_fig.pdf",
       plot = multi_fig_relative,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 120, height = 160)
```










## Raw CEWL ~ Cloacal temp & control zoom-in

```{r}
multi_fig_CEWL_by_temp <- ggarrange(CEWL_ctemp, 
                  ggarrange(CEWL_control, LEGEND, 
                            nrow = 1, ncol = 2,
                            widths = c(2, 1),
                            align = "hv"
                            ),
                  nrow = 2, ncol = 1,
                  heights = c(2,1),
          labels = c("A", "B"))
multi_fig_CEWL_by_temp

ggsave(filename = "CEWL_temp_multi_fig.pdf",
       plot = multi_fig_CEWL_by_temp,
       path = "./Results_Figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 120, height = 160)
```
